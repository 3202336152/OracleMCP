# 实现计划

- [x] 1. 初始化项目结构
  - 创建项目目录结构
  - 初始化 package.json，配置 ESM 模块和 bin 入口
  - 安装核心依赖（oracledb, commander, chalk, ora）
  - 安装开发依赖（vitest, fast-check）
  - 创建 vitest.config.js 配置文件
  - _需求: 1.1_

- [x] 2. 实现错误处理模块
  - [x] 2.1 创建错误代码枚举和自定义错误类
    - 实现 src/utils/errors.js
    - 定义 ErrorCode 枚举
    - 创建 OracleMapError 自定义错误类
    - _需求: 7.1, 7.4_
  - [ ]* 2.2 编写属性测试：退出代码一致性
    - **属性 8: 退出代码一致性**
    - **验证: 需求 7.4**

- [x] 3. 实现配置加载模块
  - [x] 3.1 创建配置加载器
    - 实现 src/config/loader.js
    - 支持 .oraclemaprc 和 oracle-map.config.json 文件
    - 实现配置文件查找和解析
    - _需求: 6.1, 6.3, 6.4_
  - [x] 3.2 实现配置合并逻辑
    - CLI 参数优先于配置文件
    - 处理空值和默认值
    - _需求: 6.2_
  - [ ]* 3.3 编写属性测试：配置合并优先级
    - **属性 2: 配置合并优先级**
    - **验证: 需求 6.2**

- [x] 4. 实现 CLI 参数解析模块
  - [x] 4.1 创建参数解析器
    - 实现 src/cli/parser.js
    - 使用 commander 定义所有 CLI 选项
    - 实现帮助信息显示
    - _需求: 1.1, 1.4, 1.5, 1.6_
  - [x] 4.2 创建参数验证器
    - 实现 src/cli/validator.js
    - 验证必填参数完整性
    - 验证参数值有效性
    - _需求: 1.2, 1.3_
  - [ ]* 4.3 编写属性测试：连接参数验证一致性
    - **属性 1: 连接参数验证一致性**
    - **验证: 需求 1.2, 1.3**

- [x] 5. 检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

- [x] 6. 实现数据库连接模块
  - [x] 6.1 创建连接管理器
    - 实现 src/db/connection.js
    - 使用 oracledb 创建连接池
    - 实现连接获取和释放
    - 实现连接关闭
    - _需求: 2.1, 2.4, 2.5_
  - [x] 6.2 实现连接错误处理
    - 处理认证失败
    - 处理网络超时
    - 提供友好错误信息
    - _需求: 2.2, 2.3_

- [x] 7. 实现类型映射模块
  - [x] 7.1 创建 Oracle 类型映射器
    - 实现 src/mapper/schema.js
    - 定义 Oracle 到 JS 类型映射表
    - 实现类型映射函数
    - _需求: 3.3_
  - [ ]* 7.2 编写属性测试：Oracle 类型映射完整性
    - **属性 3: Oracle 类型映射完整性**
    - **验证: 需求 3.3**
  - [x] 7.3 实现表结构查询
    - 查询 Oracle 数据字典获取列信息
    - 查询主键和外键约束
    - _需求: 3.1, 3.4_

- [x] 8. 实现数据映射模块
  - [x] 8.1 创建数据映射器
    - 实现 src/mapper/data.js
    - 实现日期类型转换（ISO 8601）
    - 实现 NULL 值处理
    - _需求: 4.4, 4.5_
  - [ ]* 8.2 编写属性测试：日期转换往返一致性
    - **属性 4: 日期转换往返一致性**
    - **验证: 需求 4.4**
  - [ ]* 8.3 编写属性测试：NULL 值处理一致性
    - **属性 5: NULL 值处理一致性**
    - **验证: 需求 4.5**

- [x] 9. 实现查询执行模块
  - [x] 9.1 创建查询执行器
    - 实现 src/query/executor.js
    - 实现表查询功能
    - 实现自定义 SQL 执行
    - _需求: 4.1, 4.2_
  - [x] 9.2 实现分页查询
    - 构建 OFFSET/FETCH NEXT 分页 SQL
    - 支持 limit 和 offset 参数
    - _需求: 4.3_
  - [ ]* 9.3 编写属性测试：分页 SQL 构建正确性
    - **属性 7: 分页 SQL 构建正确性**
    - **验证: 需求 4.3**

- [x] 10. 检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

- [x] 11. 实现输出格式化模块
  - [x] 11.1 创建格式化器
    - 实现 src/output/formatter.js
    - 实现 JSON 格式化
    - 实现 Object 字面量格式化
    - 实现 pretty 模式
    - _需求: 5.1, 5.2, 5.5_
  - [ ]* 11.2 编写属性测试：JSON 格式化往返一致性
    - **属性 6: JSON 格式化往返一致性**
    - **验证: 需求 5.1**
  - [x] 11.3 实现文件写入
    - 实现文件输出功能
    - 实现文件存在检查和 --force 覆盖
    - _需求: 5.3, 5.4_

- [x] 12. 实现日志工具模块
  - [x] 12.1 创建日志工具
    - 实现 src/utils/logger.js
    - 实现普通日志输出
    - 实现 verbose 模式详细日志
    - 使用 chalk 实现彩色输出
    - 使用 ora 实现加载动画
    - _需求: 7.2_

- [x] 13. 实现 CLI 入口
  - [x] 13.1 创建 CLI 入口文件
    - 实现 bin/oracle-map.js
    - 整合所有模块
    - 实现主执行流程
    - _需求: 1.1_
  - [x] 13.2 创建主模块导出
    - 实现 src/index.js
    - 导出公共 API
    - _需求: 1.1_

- [x] 14. 创建文档和示例
  - [x] 14.1 创建 README.md
    - 编写安装说明
    - 编写使用示例
    - 编写配置文件说明
    - _需求: 1.1_
  - [x] 14.2 创建示例配置文件
    - 创建 .oraclemaprc.example
    - _需求: 6.1_

- [x] 15. 最终检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户
